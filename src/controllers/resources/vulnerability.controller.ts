import { Request, Response } from "express"
import { CVE } from "models/cve"
import { Vulnerability } from "models/vulnerability"
import { errorResponse, successResponse } from "utils/responseFormat"

async function getAll(req: Request, res: Response) {
    try {
        let result: any[] = []
        const vulns = await Vulnerability.find()
        vulns.forEach(async (vul) => {
            const { cveId } = vul
            const cve = await CVE.findOne({ cveId })
            result.push({ ...vul, cve })
        })
        return res.status(200).json(successResponse(result, "Vulnerabilities retrieved successfully"))
    } catch (error) {
        return res.status(500).json(errorResponse(`Internal server error: ${error}`))
    }
}

export {
    getAll
}